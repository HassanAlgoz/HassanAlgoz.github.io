title=كيف تتعامل مع الخطأ البرمجي؟
date=2020-11-22
dir=rtl
lang=ar
----------------------
# كيف تتعامل مع الخطأ البرمجي؟

## المحاور

* الفرق الجوهري بين الخطأ الإنشائي والخطأ المُبرمَج
    *   الخطأ المُبرمَج
    *   الخطأ الإنشائي (Bug)
* صحة البرنامج من صحة إجراءاته
  *   ماذا تعني صحة الإجراء؟
*   معالجة الأخطاء المُبرمجة
    *   ضرورة عدم إهمال الخطأ المُبرمج
    *   إيصال الخطأ لمن يعنيه
    *   تمرير الخطأ من الطبقات السفلى للعليا
    *   التعامل مع الخطأ
*   إصلاح الأخطاء الإنشائية
    *   المرحلة الأولى: العلم بوجود الخطأ
    *   المرحلة الثانية: تتبع أصل الخطأ
    *   المرحلة الثالثة: إصلاح الخطأ


## الفرق الجوهري بين الخطأ الإنشائي والخطأ المبرمج

مِن الخطأ في اختيارات بعض لغات البرمجة عدم التفريق بين نوعين متباينين من الأخطاء:

1.  الخطأ المُبرمَج
2.  الخطأ الإنشائي

### الخطأ المبرمج

نتيجة إجراءٍ تدلُّ على وجود حالة تستدعي سلوك مسارٍ مختلف عن العادة. فعودة الخطأ أمرٌ محمود، وإنما المذموم كتم الخطأ.

فمن الأخطاء المُبرمَجة: تعذر قراءة ملف، تعذر الوصول إلى خادم، امتلاء مساحة التخزين، إلى غير ذلك، وسيأتي التفصيل عند الحديث عن معالجتها.

### الخطأ الإنشائي (bug)

تغيير في حالة البرنامج تُخرجه عما بُرمِجَ له (فهو غير متوقَّع، ولم يُخطَّط له).

فالخطأ الإنشائي يؤثِّرُ على صِحَّة البرنامج وقد يضرُّ بالموارد المستخدمة، ولا سبيل لمعالجته بعد وقوعه؛ ولذلك فاللغة المفلحة تُعلِم المبرمج فوْر وقوعه وتوقف البرنامج.

ومن أشهر الأخطاء الإنشائية:

1.  طلب معدومٍ (Null Dereference)
2.  تحويل نوع خاطئ (Incorrect Casting)
3.  أخذ بيانات خارِجَ نطاق حاويها منه (Out-of-bounds Access Viliation)
4.  تنفيذ قسمة عدد على صِفر (Divide by Zero)
5.  الدخول في تكرار لا نهائي (Infinite Loop)
6.  تجاوُز حسابي علوي أو سفلي (Arithmetic Overflow or Underflow)
7.  تكديس متجاوِز (Stack Overflow)
8.  تمرير بيانات من نوع خاطئ (Invalid Argument)
9.  عدم تعيين جميع المدخلات (Missing Argument)

...إلخ.

واعلم أن إهمال أي خطأٍ مبرمج خطأٌ إنشائي (Uncaught/Unhandled Error).



## صحة البرنامج من صحة إجراءاته

والصحة بهذا التعريف لا تقتضي النفع، إذْ لا بُدَّ مع صحة الأجزاء صحة وضعها بالنسبة لبعضٍ لتكوين الكل.

### ماذا تعني صحة الإجراء؟

صحة الإجراء تعني مطابقة وصفه لما يتضمن. والوصف يتضمن المعرّف والتوثيق.

ونقصد بمعرِّف الإجراء (Function Signature)، الذي به يميَّز بين إجراءٍ وآخر، فمن ذلك: اسم الإجراء ومدخلاته ومخرجاته.

ولغاتٌ تزيد: نوع المدخلات والمخرجات، ونوع الأخطاء التي قد تحصل (وقد يكون الخطأ أحد المخرجات العاديَّة في بعض اللغات).

وفائدة تمييز الإجراء بكل هذا؛ أنه يتيح وضع إجراءين بنفس الاسم مع تغيير إحدى هذه الحدود، فيعرف البرنامج أيها يسلك. ويُعرف باسم «Method Overloading» أو «Function Overloading».

ولغاتٌ تزيد: مجال المدخلات (القيم المقبولة) ومجال المخرجات (القيم المضمونة)، إلا أنك قد تجده في بعض اللغات ضمن تفاصيل الإجراء الداخلية لا من وصفه، لكن لا بدَّ من توثيق ذلك حتى لا يقع المستخدم في خطأٍ إنشائي حين يعطي الإجراء ما لا يقبل أو يتوقع منه ما لا يضمن.

فكلما زاد بيان وصف الإجراء كان أدعى لحُسن استعماله، واللغة المعبرة تغني المستخدم بهذا المعرّف (مع التوثيق) عن النظر في تفاصيل الإجراء.

ومن الأمور المهمة في التوثيق:

1.  توثيق الأخطاء التي يخرُج بها مع بيان معنى كل خطأ وما يترتب عليه
2.  توثيق ما إذا كان الإجراء يعتمد على بيانات غير المدخلات المباشرة
3.  توثيق ما إذا كان الإجراء يؤثر في بيانات غير المخرجات المباشرة

...إلخ مما يهمُّ مستخدم الإجراء بأي حال، وهذا يختلف من لغة إلى لغة، فعضها يُغني تعبيرُها عن كثيرٍ من التوثيق، ولا غنى عن التوثيق ولغة البرمجة لا تكفي.

فإذا خالف المستخدم باستخدامه الإجراء ما وُصف به، كان ذلك خطاً منه: خطأٌ إنشائي لا بد من إصلاحه.

وإذا استخدمه كما وُصف، وأخذ في الاعتبار حالات خطأه المُبرمَجة فعالجها أحسَن.



## معالجة الأخطاء المبرمجة

### ضرورة عدم إهمال الأخطاء المبرمجة

الخطأ معلومة أقلُّ ما تفيده عدم تمام الإجراء المطلوب، وبالتالي فإن إهمال هذه المعلومة يفضي لخطأ إنشائي في البرنامج. إذاً البرنامج الذي لا يعالج الأخطاء الناتجة من الإجراءات، كالذي يستدعيها ولا يكترث بنتاجها، فهو برنامج ناقصٌ أصلاً، خاطئٌ منطقيًّا، وإذا أفلح فإنه أمرٌ استثنائي ولا يعني ذلك أن البرنامج صحيح.

### إيصال الخطأ لمن يعنيه

الخطأ رسالة أو معلومة، يجب أن تصل إلى من يستطيع معالجته. فإذا كان علاجه بيد مدير بيئة البرنامج، كان لابد من أن يظهر الخطأ كرسالة يفهمها هذا الإنسان ويستدلُّ بها على مكمن الخطأ فيعالجه، وقد يهتمُّ بالخطأ مطوِّرُ البرنامج فيجب أن يصل إليه الخطأ.

وطرق إيصال الخطأ قد تكون بكتابته في ملفٍّ ثابت في بيئة البرنامج، أو إرساله عبر الشبكة (وهي ما يُعرف بملفات السجلات)، أو إعلام المستخدم بالخطأ واستئذانه بإيصال الخطأ للمعني به، إلى غير ذلك من الطُّرق.

وقد يظهر الخطأ للمستخدم المباشر للبرنامج فيخيره، فيختار فيمشي البرنامج بناءً على اختياره.

### تمرير الخطأ من الطبقات السُّفلى للعُليا

وما ذكرنا في إيصال الخطأ إلى البشر هو من الحالات القليلة التي لا يستطيع معها البرنامج أن يتخذ القرار بنفسه لأي سببٍ كان، أو أنه جرَّب أن يعالجه واستنفذ جميع الطرق، لكن غالب الأخطاء موجَّهة للبرنامج نفسه ويستطيع التعامل معها.

وفي كل خطأٍ لدينا طريقان:

1.  إخراج الخطأ للمستدعي ليتعامل معه
2.  التعامل معه في نفس الإجراء

فالإجراءُ الواحد لا يعرف موقعه من البرنامج، وإنما يرجع الخطأ لمن استدعاه، ولك أن تتخيل أنه لو حصل خطأ في استدعاء في سلسلة من ستة قبله أن الخطأ يعود من السابع (صاحب الخطأ) لهذه السلسلة ويقِفُ عند من يتعامل معه.

### التعامل مع الخطأ

وإليك أمثلة على التعامل مع الخطأ:

قد يتوقع الإجراء في مساره العادي وجود ملف كذا، ثم لا يجده، فيتعامل مع هذا الخطأ -مثلاً- بأن يُنشئ الملف.

قد يحاول أن يتصل البرنامج بخادم فلا يستطيع الوصول إليه، فقد يتعامل مع هذا الخطأ بالمعاودة بعد فترة، وثم إذا تكرر الخطأ عدداً معيَّنًا يتعامل مع ذلك بإظهار رسالة للمستخدم يستشيره فيها ويُعلمه بما حصل.

وقد يكون الفعل الصحيح مع الخطأ إيقاف البرنامج وإعلام المستخدم بالسبب.


## إصلاح الأخطاء الإنشائية

وهو ما يُعرف باسم debugging، أي: رفع الخطأ الإنشائي، وهو على مراحل:

### المرحلة الأولى: العلم بوجود الخطأ

وعدوُّ ذلك أن يُمسك البرنامج عن أخطائه الإنشائية، ويُكمل عمله، لأنه بذلك يُكنُّ فساداً يستشري إلى بقية أجزائه وقد يخرج إلى الأنظمة الأخرى المتصلة به، ثم قد لا يموت إلا بعد إحداث مشاكل أخرى، فيصعب حينئذٍ تحديد منشأ الخطأ لإصلاحه.

واللغات الجميلة ذكية في بيان الأخطاء الإنشائية ومواضعها، لا اللغات التي تنفجر بكومة هائلة من الطلاسم وأسماء الملفات وأرقم الأسطر على أصغر خطأ، وهذا محلُّ تنافس بين لغات البرمجة.

### المرحلة الثانية: تتبع أصل الخطأ

وهذا نجده على نوعين: إما أن تفرز اللغة رسالة آليَّة تحتوي سلسلة الاستدعاءات التي كانت حين حدوث الخطأ، واسم الملف ورقم السطر الذي حصل فيه، وهذا يحصُلُ في الأخطاء الإنشائية.

والنوع الثاني: أن يكون تصعيد الخطأ برمجيًّا يحوي المعلومات المفيدة لتصحيحه من خطأ كل طبقة، فتظهر لك سلسلة سببيَّةٌ من رسالات خطأٍ ينبئُ كُلُّ منها عن السياق الذي كانت فيه والخطأ الذي حصل آنذاك، حتى الخطأ الأوَّل.

ويُمكن استعمال المدقق (debugger) الذي يوقف البرنامج عند نقاط توقُّف يحددها المتتبع للخطأ، ويطلعه على حال البرنامج عند تلك النقطة، كما يُمكّنه من التحكم في التنفيذ بالخطوِ خطوة واحدة أو الإكمال العادي حتى نقطة توقُّف قادمة.

فالمدقق أقرب ما يمكن للمبرمج أن يكون من البرنامج حين تنفيذه، إذ يكشف لك دواخله.

أما استعمال الكتابة على السجلات الظاهرة باستعمال console.log أو printf ومثيلاتها بغرض التدقيق، فإن ذلك غالبًا ما يكون أفضل منه استعمال المدقق.

### المرحلة الثالثة: إصلاح الخطأ

ولا نبدأ بالإصلاح إلا بعد تعيين أصل الخطأ، ثم يكون موضِعُ الإصلاح ذلك الموضع لا غيره، وقد يكون بإزالة أو بإضافة أو تعديل أو تغيير ترتيب، ونحرص فيه أن نُصلِحَ ما يترتب على هذا الإصلاح من أخطاء في مواضع أخرى.
